# üí≥ PayPal Integration Setup Guide

This guide will help you set up PayPal sandbox for payment processing in the MERN Store application.

## Prerequisites

1. A PayPal Developer account (free): https://developer.paypal.com/
2. Access to your backend `.env` file
3. Access to your frontend environment configuration

## Step 1: Create PayPal Sandbox App

1. Go to https://developer.paypal.com/dashboard/applications/sandbox
2. Click **"Create App"**
3. Fill in:
   - **App Name**: MERN Store (or any name you prefer)
   - **Merchant**: Select your sandbox business account
   - **Features**: Select **"Accept Payments"**
4. Click **"Create App"**

## Step 2: Get Your Credentials

After creating the app, you'll see:
- **Client ID**
- **Client Secret**

Copy these values - you'll need them for your environment variables.

## Step 3: Configure Backend Environment Variables

Add the following to your `backend/.env` file:

```env
# PayPal Sandbox Credentials
PAYPAL_CLIENT_ID=your_client_id_here
PAYPAL_CLIENT_SECRET=your_client_secret_here

# Frontend URL (for PayPal redirects)
FRONTEND_URL=http://localhost:5173
```

**Important**: Replace `your_client_id_here` and `your_client_secret_here` with your actual credentials from Step 2.

## Step 4: Configure Frontend Environment Variables

Create or update your `frontend/.env` file (or `frontend/.env.local`):

```env
VITE_PAYPAL_CLIENT_ID=your_client_id_here
```

**Note**: Only the Client ID is needed on the frontend (for security reasons, the secret stays on the backend).

## Step 5: Test PayPal Sandbox Accounts

PayPal provides test accounts for sandbox testing:

1. Go to https://developer.paypal.com/dashboard/accounts
2. Under **"Sandbox"**, you'll find:
   - **Personal Account** (for testing buyer flow)
   - **Business Account** (for testing seller flow)

### Test Credentials

You can use PayPal's default sandbox accounts or create your own:

**Default Personal Account** (Buyer):
- Email: `sb-xxxxx@personal.example.com`
- Password: (generated by PayPal)

**Default Business Account** (Seller):
- Email: `sb-xxxxx@business.example.com`
- Password: (generated by PayPal)

## Step 6: Testing the Payment Flow

1. **Start your backend server**:
   ```bash
   cd backend
   npm run dev
   ```

2. **Start your frontend server**:
   ```bash
   cd frontend
   npm run dev
   ```

3. **Test the checkout process**:
   - Add products to cart
   - Go to checkout
   - Select "PayPal" as payment method
   - Click the PayPal button
   - Log in with a sandbox personal account
   - Complete the payment

4. **Verify payment**:
   - Check your backend logs for payment confirmation
   - Check your database - the order should have `isPaid: true` and `paidAt` timestamp
   - Check `paymentInfo.confirmation` for PayPal transaction details

## Step 7: Switch to Production (When Ready)

When you're ready to go live:

1. Create a **Production App** in PayPal Dashboard
2. Get production credentials
3. Update `backend/config/paypal.js`:
   ```javascript
   // Change from SandboxEnvironment to LiveEnvironment
   return new paypal.core.LiveEnvironment(clientId, clientSecret);
   ```
4. Update environment variables with production credentials
5. Update `FRONTEND_URL` to your production domain

## Troubleshooting

### PayPal Button Not Showing
- Check browser console for errors
- Verify `VITE_PAYPAL_CLIENT_ID` is set correctly
- Ensure PayPal SDK is loaded (check Network tab)

### Payment Not Capturing
- Check backend logs for errors
- Verify `PAYPAL_CLIENT_ID` and `PAYPAL_CLIENT_SECRET` are correct
- Ensure order is created before PayPal order creation

### "Invalid Client ID" Error
- Double-check your credentials
- Ensure you're using sandbox credentials (not production)
- Try regenerating credentials in PayPal Dashboard

## Security Notes

- ‚ö†Ô∏è **Never commit** `.env` files to version control
- ‚ö†Ô∏è **Never expose** `PAYPAL_CLIENT_SECRET` to the frontend
- ‚úÖ Use environment variables for all sensitive data
- ‚úÖ Keep production credentials secure

## Additional Resources

- [PayPal Developer Documentation](https://developer.paypal.com/docs/)
- [PayPal Checkout Integration Guide](https://developer.paypal.com/docs/checkout/)
- [PayPal Sandbox Testing Guide](https://developer.paypal.com/docs/api-basics/sandbox/)
